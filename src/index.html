<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/2.0.3/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.3/mode/markdown/markdown.min.js"></script>
    <script src="https://unpkg.com/markdown-pdf@11.0.0/dist/markdown-pdf.js"></script>
    <link rel="stylesheet" href="styles.css">
  </head>
  </head>
  <body>
    <div id="toolbar">
      <button id="bold"><b>B</b></button>
      <button id="preview"><b>Preview</b></button>
      <!-- Add more buttons as needed -->
    </div>
    <div id="preview-box">
      <!-- Preview will be rendered here -->
    </div>
    <textarea id="editor"></textarea>
  </body>
  <script>
    marked.setOptions({
      breaks: true,
    });

    var preview_mode = false;

    document.getElementById('preview').addEventListener('click', function() {
      if (preview_mode) {
        preview_mode = false;
        document.getElementById('preview').innerHTML = '<b>Preview</b>';
        document.getElementById('preview-box').style.display = 'none';
        editor.getWrapperElement().style.display = 'block';
      } else {
        preview_mode = true;
        document.getElementById('preview').innerHTML = '<b>Edit</b>';
        document.getElementById('preview-box').innerHTML = marked(editor.getValue());
        document.getElementById('preview-box').style.display = 'block';
        editor.getWrapperElement().style.display = 'none';

      }
    });

    var editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
      lineNumbers: false,
      mode: 'markdown'
    });

    document.getElementById('bold').addEventListener('click', function() {
      var selection = editor.getSelection();
      var cursor = editor.getCursor();
      if (selection.startsWith('**') && selection.endsWith('**')) {
          // Remove bold
          editor.replaceSelection(selection.slice(2, -2));
      } else {
          // Add bold
          editor.replaceSelection('**' + selection + '**');
      }
    });

    editor.addKeyMap({
      'Ctrl-B': function(cm) {
          var selection = cm.getSelection();
          var cursor = cm.getCursor();
          if (selection.startsWith('**') && selection.endsWith('**')) {
              // Remove bold
              cm.replaceSelection(selection.slice(2, -2));
              // Adjust cursor position
              cm.setCursor({line: cursor.line, ch: cursor.ch - 2});
          } else {
              // Add bold
              cm.replaceSelection('**' + selection + '**');
              // Adjust cursor position
              cm.setCursor({line: cursor.line, ch: cursor.ch + 2});
          }
      }
    });

  </script>
</html>